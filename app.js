!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t()
else if("function"==typeof define&&define.amd)define([],t)
else{var e
e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.McHead=t()}}(function(){return function t(e,i,o){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require
if(!a&&h)return h(r,!0)
if(n)return n(r,!0)
var u=new Error("Cannot find module '"+r+"'")
throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}}
e[r][0].call(l.exports,function(t){var i=e[r][1][t]
return s(i?i:t)},l,l.exports,t,e,i,o)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<o.length;r++)s(o[r])
return s}({1:[function(t,e,i){function o(t,e){var i=new FileReader,o=new Image
o.onload=function(){t.model.setImage(this),t.justRender()},i.onload=function(t){o.src=t.target.result},i.readAsDataURL(e)}var s=t("./dom"),n=t("./utils"),r=t("./camera"),a=t("./model"),h=t("./mouse"),u=e.exports=function(t,e,i,o,s){this.options=t,this.canvas=e,this.output=i,this.size=n.point(o,s)}
u.prototype={init:function(){this.initThree(),this.initModel(),this.initMouseHandler(),this.initOptions()},initThree:function(){var t=this,e=this.size.x,i=this.size.y,o=new r(e,i,50,.1,1e3,(-1e3),1e3),s=new THREE.Scene,n=new THREE.TextureLoader,a=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0})
a.setClearColor(16777215,0),a.setSize(e,i),a.domElement.className="renderer",this.canvas.appendChild(a.domElement),n.load("steve.png",function(e){e.magFilter=e.minFilter=THREE.NearestFilter,t.model.setTexture(e),t.justRender()}),this.scene=s,this.renderer=a,this.camera=o},initMouseHandler:function(){this.mouse=new h(this,Math.PI/4,Math.PI/4),this.mouse.attach(this.renderer.domElement)},initModel:function(){this.model=new a,this.scene.add(this.model.group),this.model.headOnly(!0)},initOptions:function(){var t=this
s.$$("input",this.options).forEach(function(e){s.on(e,"change",function(){t.change(e.name,e)})}),s.on(s.$("#reset"),"click",function(){s.$("[name=x]").value=s.$("[name=y]").value=45,t.mouse.setX(45),t.mouse.setY(45),t.justRender()})},change:function(t,e){"head"==t?this.model.headOnly(e.checked):"outer"==t?this.model.includeHair(e.checked):"flat"==t?e.checked?this.camera.toOrtho():this.camera.toPerspec():"texture"==t?o(this,e.files[0]):"x"==t?this.mouse.setX(parseInt(e.value)):"y"==t&&this.mouse.setY(parseInt(e.value)),this.justRender()},changed:function(t,e){s.$("[name=x]").value=t.toFixed(4),s.$("[name=y]").value=e.toFixed(4)},up:function(){this.output.src=this.renderer.domElement.toDataURL("image/png")},render:function(t,e){this.model.rotate(t,e),this.renderer.render(this.scene,this.camera.camera)},justRender:function(){this.render(this.mouse.result.x,this.mouse.result.y),this.up()}}},{"./camera":2,"./dom":3,"./model":5,"./mouse":6,"./utils":7}],2:[function(t,e,i){var o=e.exports=function(t,e,i,o,s,n,r){this.fov=i
var a=t/2,h=e/2
this.ortho=new THREE.OrthographicCamera((-a),a,h,(-h),n,r),this.ortho.position.z=4,this.perspec=new THREE.PerspectiveCamera(i,t/e,o,s),this.perspec.position.z=544,this.toOrtho()}
o.prototype=Object.create(THREE.Camera.prototype),o.prototype.constructor=THREE.CombinedCamera,o.prototype.toOrtho=function(){this.camera=this.ortho},o.prototype.toPerspec=function(){this.camera=this.perspec}},{}],3:[function(t,e,i){function o(t){return Array.prototype.slice.call(t)}function s(t,e){return(e||document).querySelector(t)}function n(t,e){return o((e||document).querySelectorAll(t))}function r(t,e,i){t.addEventListener(e,i)}e.exports={$:s,$$:n,on:r}},{}],4:[function(t,e,i){e.exports={dom:t("./dom"),App:t("./app")}},{"./app":1,"./dom":3}],5:[function(t,e,i){var o=t("./utils"),s=e.exports=function(){var t=new THREE.MeshBasicMaterial,e=new THREE.MeshBasicMaterial,i=new THREE.Object3D,s=o.limb(t,0,8,8,8,8),n=o.limb(e,0,8,8,8,8),r=o.limb(t,0,-2,8,12,4),a=o.limb(t,-6,-2,4,12,4),h=o.limb(t,6,-2,4,12,4),u=o.limb(t,-2,-14,4,12,4),l=o.limb(t,2,-14,4,12,4)
this.material=t,this.outerMaterial=e,this.group=i,this.head=s,this.outer=n,this.body=r,this.left_arm=a,this.left_leg=u,this.right_arm=h,this.right_leg=l,this.applyUV(),o.invert(h),o.invert(l),i.position.set(0,32,0),i.add(s),i.add(n),i.add(r),i.add(a),i.add(h),i.add(u),i.add(l),i.scale.x=i.scale.y=i.scale.z=96,n.scale.x=n.scale.y=n.scale.z=1.1,n.material.transparent=!0}
s.prototype={rotate:function(t,e){this.group.rotation.x=t,this.group.rotation.y=e},headOnly:function(t){t?(this.group.remove(this.body),this.group.remove(this.left_arm),this.group.remove(this.left_leg),this.group.remove(this.right_arm),this.group.remove(this.right_leg),this.head.position.y=0,this.outer.position.y=0):(this.group.add(this.body),this.group.add(this.left_arm),this.group.add(this.left_leg),this.group.add(this.right_arm),this.group.add(this.right_leg),this.head.position.y=1,this.outer.position.y=1)},includeHair:function(t){this.outer.visible=t},applyUV:function(){o.apply_cube(this.head.geometry,0,16,8,8,8),o.apply_cube(this.outer.geometry,32,16,8,8,8),o.apply_cube(this.body.geometry,16,0,8,12,4),o.apply_cube(this.left_arm.geometry,40,0,4,12,4),o.apply_cube(this.right_arm.geometry,40,0,4,12,4),o.apply_cube(this.left_leg.geometry,0,0,4,12,4),o.apply_cube(this.right_leg.geometry,0,0,4,12,4)},setTexture:function(t){this.material.map=t,this.outerMaterial.map=t},setImage:function(t){this.material.map.image=t,this.material.map.needsUpdate=!0,this.outerMaterial.map.image=t,this.outerMaterial.map.needsUpdate=!0}}},{"./utils":7}],6:[function(t,e,i){var o=t("./dom"),s=t("./utils"),n=e.exports=function(t,e,i){this.target=t,this.on=!1,this.result=s.point(e,i),this.first=s.point(0,0),this.tmp=s.point(0,0),this.last=s.point(0,0)}
n.prototype={attach:function(t){o.on(t,"mousedown",this.down.bind(this)),o.on(t,"mousemove",this.move.bind(this)),o.on(t,"mouseout",this.out.bind(this)),o.on(t,"mouseup",this.up.bind(this))},out:function(){this.on=!1},down:function(t){this.on=!0,this.first.x=t.pageX,this.first.y=t.pageY,this.last.x=this.result.x,this.last.y=this.result.y},move:function(t){this.on&&(this.tmp.x=t.pageX-this.first.x,this.tmp.y=t.pageY-this.first.y,this.applyRotation(),this.render())},up:function(t){this.on=!1,this.applyRotation(),this.target.up()},applyRotation:function(){var t=2*Math.PI
this.result.x=(this.last.x+this.tmp.x/90)%t,this.result.y=(this.last.y+this.tmp.y/90)%t,this.target.changed(this.getX(),this.getY())},setX:function(t){this.result.x=t/180*Math.PI,this.render()},setY:function(t){this.result.y=t/180*Math.PI,this.render()},getX:function(){return 180*this.result.x/Math.PI},getY:function(){return 180*this.result.y/Math.PI},render:function(){this.target.render(this.result.x,this.result.y)}}},{"./dom":3,"./utils":7}],7:[function(t,e,i){function o(t,e){return{x:t,y:e}}function s(t,e){return new THREE.Vector2(t/64,e/32)}function n(t,e,i,o,n,r){e=2*e
var a=[s(i,o+r),s(i+n,o+r),s(i+n,o),s(i,o)]
6!=e?(t.faceVertexUvs[0][e]=[a[0],a[3],a[1]],t.faceVertexUvs[0][e+1]=[a[3],a[2],a[1]]):(t.faceVertexUvs[0][e]=[a[3],a[0],a[2]],t.faceVertexUvs[0][e+1]=[a[0],a[1],a[2]])}function r(t,e,i,o,s,r){n(t,4,e+r,i,o,s),n(t,5,e+r+o+r,i,o,s),n(t,0,e+r+o,i,r,s),n(t,1,e,i,r,s),n(t,2,e+r,i+s,o,r),n(t,3,e+r+o,i+s,o,r),t.uvsNeedUpdate=!0}function a(t,e,i,o,s,n){var r=new THREE.BoxGeometry(o/8,s/8,n/8),a=new THREE.Mesh(r,t)
return a.position.x=e?e/8:0,a.position.y=i?i/8:0,a}function h(t){var e=t.geometry
e.scale(-1,1,1),e.scale(-1,1,1),e.dynamic=!0,e.__dirtyVertices=!0,e.__dirtyNormals=!0,t.flipSided=!0
for(var i=0,o=e.faces.length;i<o;i++){var s=e.faces[i]
s.normal.x*=-1,s.normal.y*=-1,s.normal.z*=-1}e.computeVertexNormals(),e.computeFaceNormals()}e.exports={point:o,vec:s,apply_uv:n,apply_cube:r,limb:a,invert:h}},{}]},{},[4])(4)})
